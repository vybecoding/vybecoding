# BMAD + TMUX Integration Configuration
# Optimized for parallel agent workflows and autonomous operation

# ============================================================================
# SESSION SETTINGS
# ============================================================================

# Terminal settings
set -g default-terminal "screen-256color"
set -g history-limit 50000
set -g buffer-limit 20

# Session persistence
set -g detach-on-destroy off
set -g destroy-unattached off

# Mouse support for easier navigation
set -g mouse on

# ============================================================================
# WINDOW & PANE SETTINGS  
# ============================================================================

# Window numbering
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Automatic window naming for BMAD agents
set -g automatic-rename on
set -g automatic-rename-format "#{?#{==:#{pane_current_command},claude},BMAD-#{window_index},#{pane_current_command}}"

# Window activity monitoring
set -g monitor-activity on
set -g visual-activity off

# ============================================================================
# STATUS BAR CONFIGURATION
# ============================================================================

# Status bar update interval (matches BMAD 15-min check-ins)
set -g status-interval 15

# Status bar positioning and basic settings
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=colour234 fg=colour137'

# Left status: BMAD session identifier
set -g status-left-length 50
set -g status-left '#[fg=colour154,bold][BMAD:#S] #[fg=colour245]#{?client_prefix,‚å® ,}'

# Right status: Time and session info
set -g status-right-length 100
set -g status-right '#[fg=colour245]#{?window_bigger,[#{window_offset_x}#,#{window_offset_y}] ,}#[fg=colour154]%H:%M #[fg=colour245]%d-%b'

# Window status format
set -g window-status-current-style 'fg=colour154 bg=colour238 bold'
set -g window-status-current-format ' #I:#W#{?window_flags,#{window_flags}, } '
set -g window-status-style 'fg=colour245'
set -g window-status-format ' #I:#W#{?window_flags,#{window_flags}, } '

# ============================================================================
# PANE SETTINGS
# ============================================================================

# Pane borders for team identification
set -g pane-border-style 'fg=colour238'
set -g pane-active-border-style 'fg=colour154'

# Pane titles for agent identification
set -g pane-border-status top
set -g pane-border-format '#[fg=colour154]#{?pane_active,#[bold],}#{pane_title}#[fg=colour245] #{pane_current_command}'

# ============================================================================
# KEY BINDINGS
# ============================================================================

# Prefix key (default Ctrl-b)
set -g prefix C-b
bind C-b send-prefix

# Quick pane navigation for monitoring teams
bind -n M-h select-pane -L
bind -n M-j select-pane -D  
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Quick window switching for team terminals
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4

# BMAD-specific shortcuts
bind b new-window -n "BMAD-Main" "claude"
bind d new-window -n "BMAD-Dev" "claude --agent bmad-dev"
bind q new-window -n "BMAD-QA" "claude --agent bmad-qa"
bind s new-window -n "BMAD-SM" "claude --agent bmad-sm"

# Team layout shortcuts
bind T source-file ~/.tmux-bmad-layouts.conf

# ============================================================================
# BMAD TEAM LAYOUTS
# ============================================================================

# Epic-01 parallel layout (3 teams)
bind E new-session -d -s "Epic01-Parallel" \; \
  rename-window "Orchestrator" \; \
  send-keys "claude --agent bmad-tmux-orchestrator" Enter \; \
  new-window -n "Team-Alpha" \; \
  split-window -h \; \
  split-window -v \; \
  select-pane -t 0 \; send-keys "claude --agent bmad-dev" Enter \; \
  select-pane -t 1 \; send-keys "claude --agent bmad-qa" Enter \; \
  select-pane -t 2 \; send-keys "npm run dev" Enter \; \
  new-window -n "Team-Beta" \; \
  split-window -h \; \
  split-window -v \; \
  select-pane -t 0 \; send-keys "claude --agent bmad-dev" Enter \; \
  select-pane -t 1 \; send-keys "claude --agent bmad-qa" Enter \; \
  select-pane -t 2 \; send-keys "npm run dev" Enter \; \
  new-window -n "Team-Gamma" \; \
  split-window -h \; \
  split-window -v \; \
  select-pane -t 0 \; send-keys "claude --agent bmad-dev" Enter \; \
  select-pane -t 1 \; send-keys "claude --agent bmad-qa" Enter \; \
  select-pane -t 2 \; send-keys "npm run dev" Enter \; \
  select-window -t "Orchestrator"

# Full-stack development layout
bind F new-session -d -s "FullStack-Dev" \; \
  rename-window "Orchestrator" \; \
  send-keys "claude --agent bmad-tmux-orchestrator" Enter \; \
  new-window -n "Frontend" \; \
  split-window -h \; \
  split-window -v \; \
  select-pane -t 0 \; send-keys "claude --agent bmad-dev" Enter \; \
  select-pane -t 1 \; send-keys "claude --agent bmad-qa" Enter \; \
  select-pane -t 2 \; send-keys "npm run dev" Enter \; \
  new-window -n "Backend" \; \
  split-window -h \; \
  split-window -v \; \
  select-pane -t 0 \; send-keys "claude --agent bmad-dev" Enter \; \
  select-pane -t 1 \; send-keys "claude --agent bmad-qa" Enter \; \
  select-pane -t 2 \; send-keys "npm run convex" Enter \; \
  new-window -n "Management" \; \
  split-window -h \; \
  select-pane -t 0 \; send-keys "claude --agent bmad-sm" Enter \; \
  select-pane -t 1 \; send-keys "claude --agent bmad-doc-writer" Enter \; \
  select-window -t "Orchestrator"

# ============================================================================
# AUTOMATION SETTINGS
# ============================================================================

# Automatic session saving (for persistence)
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Logging for autonomous operation monitoring
set -g @logging-path "$HOME/.tmux-bmad-logs"
set -g @screen-capture-path "$HOME/.tmux-bmad-logs"
set -g @save-complete-history-path "$HOME/.tmux-bmad-logs"

# ============================================================================
# VISUAL ENHANCEMENTS
# ============================================================================

# Message styling
set -g message-style 'fg=colour154 bg=colour234 bold'
set -g message-command-style 'fg=colour154 bg=colour234'

# Clock mode
set -g clock-mode-colour colour154
set -g clock-mode-style 24

# Copy mode styling
set -g mode-style 'fg=colour154 bg=colour238 bold'

# ============================================================================
# BMAD INTEGRATION HOOKS
# ============================================================================

# Hook for BMAD agent startup
set-hook -g after-new-window 'if -F "#{==:#{pane_current_command},claude}" "set pane-border-style fg=colour154"'

# Hook for autonomous check-ins (every 15 minutes)
set-hook -g alert-activity 'display-message "BMAD Activity: #{window_name}"'

# Hook for session persistence
set-hook -g session-created 'display-message "BMAD Session: #{session_name} initialized"'
set-hook -g session-closed 'display-message "BMAD Session: #{session_name} saved"'

# ============================================================================
# PERFORMANCE OPTIMIZATION
# ============================================================================

# Reduce escape time for better responsiveness
set -g escape-time 10

# Increase repeat time for key sequences
set -g repeat-time 1000

# Optimize for multiple panes
set -g aggressive-resize on

# ============================================================================
# USAGE INSTRUCTIONS
# ============================================================================

# Quick start commands:
# tmux new-session -s bmad-project
# tmux source-file .tmux-bmad.conf
# 
# Layouts:
# Prefix + E : Epic-01 parallel layout
# Prefix + F : Full-stack development layout
# Prefix + T : Load custom team layouts
#
# Navigation:
# Alt + h/j/k/l : Navigate panes
# Alt + 1/2/3/4 : Switch windows
# 
# BMAD shortcuts:
# Prefix + b : New BMAD main window
# Prefix + d : New BMAD dev window  
# Prefix + q : New BMAD QA window
# Prefix + s : New BMAD SM window
